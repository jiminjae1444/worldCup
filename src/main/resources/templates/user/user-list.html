<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원 승인 목록</title>
  <style>
    /* 모달 스타일 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      width: 300px;
    }
    .modal-header {
      font-size: 18px;
      font-weight: bold;
    }
    .modal-body {
      margin-top: 10px;
    }
    .modal-footer {
      margin-top: 20px;
      text-align: right;
    }
    .btn {
      padding: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }
    .btn-primary {
      background-color: #007bff;
      color: white;
    }
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    .btn-danger {
      background-color: #dc3545;
      color: white;
    }
    .btn:hover {
      opacity: 0.8;
    }
  </style>
</head>
<body>
<div th:replace="~{header.html}"></div>
<div class="container">
  <h2 class="mt-5">회원 승인 목록</h2>
  <table class="table table-bordered mt-4">
    <thead>
    <tr>
      <th>아이디</th>
      <th>승인 상태</th>
      <th>관리</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
      <td th:text="${user.username}"></td>
      <td th:text="${user.approved ? '승인됨' : '대기중'}"></td>
      <td>
        <button class="btn btn-success approve-btn" data-user-id="${user.id}" data-username="${user.username}" th:disabled="${user.approved}">
          승인
        </button>
        <button class="btn btn-danger deny-btn" data-user-id="${user.id}" data-username="${user.username}" th:disabled="${!user.approved}">
          거부
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- 모달 -->
<div id="approvalModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>사용자 역할 선택</h3>
    </div>
    <div class="modal-body">
      <p>사용자의 역할을 선택하세요:</p>
      <label><input type="radio" name="role" value="ADMIN"> 관리자</label><br>
      <label><input type="radio" name="role" value="USER" checked> 사용자</label>
    </div>
    <div class="modal-footer">
      <button id="confirmApproval" class="btn btn-primary">확인</button>
      <button id="closeModal" class="btn btn-secondary">취소</button>
    </div>
  </div>
</div>

<script>
  // 모달 관련 코드
  const approvalModal = document.getElementById('approvalModal')
  const approveBtns = document.querySelectorAll('.approve-btn')
  const denyBtns = document.querySelectorAll('.deny-btn')
  let currentUserId = null
  let currentUsername = null

  // 승인 버튼 클릭 시 모달 표시
  approveBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      currentUserId = btn.getAttribute('data-user-id')
      currentUsername = btn.getAttribute('data-username')
      document.querySelector('.modal-body p').textContent = `${currentUsername}의 역할을 선택하세요:`
      approvalModal.style.display = 'flex'
    })
  })

  // 거부 버튼 클릭 시 모달 표시
  denyBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      currentUserId = btn.getAttribute('data-user-id')
      currentUsername = btn.getAttribute('data-username')
      document.querySelector('.modal-body p').textContent = `${currentUsername}의 역할을 선택하세요:`
      approvalModal.style.display = 'flex'
    })
  })

  // 모달 닫기
  document.getElementById('closeModal').addEventListener('click', function() {
    approvalModal.style.display = 'none'
  })

  // 승인 확정 버튼 클릭 시 처리
  document.getElementById('confirmApproval').addEventListener('click', function() {
    const selectedRole = document.querySelector('input[name="role"]:checked').value

    // 승인 처리 후 서버에 전달하는 로직 (예시로 로그 출력)
    console.log(`User ID: ${currentUserId}, Username: ${currentUsername}, Role: ${selectedRole}`)

    // 모달 닫기
    approvalModal.style.display = 'none'

  });
</script>

</body>
</html>
